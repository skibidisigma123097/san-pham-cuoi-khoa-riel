<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-sRIl4kxILFvY47J16cr9ZwB07vP4J8+LH7qKQnuqkuIAvNWLzeN8tE5YBujZqJLB" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css"
        integrity="sha512-DTOQO9RWCH3ppGqcWaEA1BIZOC6xxalwEsw9c2QQeAIftl+Vegovlnee1c9QX4TctnWMn13TZye+giMm8e2LwA=="
        crossorigin="anonymous" referrerpolicy="no-referrer" />

    <style>
        .container {
            border: 2px solid black;
            margin-top: 20px;
            width: 500px;
            min-height: 500px;
            background-color: white;
        }

        .topbar {
            background: white;
            padding: 10px 18px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .brand {
            font-weight: 600;
        }

        .icon {
            width: 40px;
            height: 40px;
            background-image: url("img/Screenshot 2025-03-21 213123.png");
            background-size: contain;
            background-repeat: no-repeat;
            background-position: center;
        }

        .button {
            cursor: pointer;
            width: 450px;
        }

        .password-container {
            position: relative;
        }

        .toggle-password {
            position: absolute;
            top: 50%;
            right: 15px;
            transform: translateY(-50%);
            background: none;
            border: none;
            cursor: pointer;
            color: #555;
        }

        .toggle-password:hover {
            color: #000;
        }

        .username,
        .password {
            width: 450px;
            border: 1px solid black;
        }

        body {
            background-image: url(img/Screenshot\ 2025-06-23\ 100759.png);
            background-size: cover;
            background-repeat: no-repeat;
            background-position: center;
        }
    </style>
</head>

<body>
    <header class="topbar">
        <div class="icon"></div>
        <div class="brand">Gamehub fake</div>
    </header>

    <div class="container">
        <h1 class="text-center">Tạo tài khoản</h1>
        <p class="text-center">Tạo tài khoản để truy cập vào Gamehub fake!</p>
        <br>

        <form id="SignupForm">
            <div class="form-floating mb-3">
                <input type="email" id="email" name="email" class="form-control" placeholder="email" required>
                <label for="username">Vui lòng nhập email</label>
            </div>

            <div class="form-floating mb-3">
                <input type="text" id="username" name="username" class="form-control" placeholder="username" required>
                <label for="username">Vui lòng nhập username</label>
            </div>

            <div class="form-floating mb-3 password-container">
                <input type="password" id="password1" name="password1" class="form-control" placeholder="password"
                    required required minlength="6" maxlength="18" autocomplete="off">
                <label for="password">Vui lòng nhập mật khẩu</label>

                <button type="button" class="toggle-password" data-target="password1">
                    <i class="fa-solid fa-eye"></i>
                </button>
            </div>

            <div class="form-floating mb-3 password-container">
                <input type="password" id="password2" name="password2" class="form-control"
                    placeholder="confirm password" required required minlength="6" maxlength="18" autocomplete="off">
                <label for="password">Xác nhận mật khẩu</label>

                <button type="button" class="toggle-password" data-target="password2">
                    <i class="fa-solid fa-eye"></i>
                </button>
            </div>
            <input type="checkbox" name="dongy" style="margin-bottom: 15px;" required>Tôi đã đồng ý với các điều khoản
            dịch vụ và chính sách bảo mật
            <input type="submit" class="button btn btn-primary" value="Đăng kí">
        </form>
        <p class="small" style="margin-top: 15px;">Đã có tài khoản? <a href="dangnhap1.html">Đăng nhập</a></p>
    </div>

    <script>
        const toggleButtons = document.querySelectorAll(".toggle-password");

        toggleButtons.forEach(btn => {
            btn.addEventListener("click", () => { /*lang nghe su kien click moi lan bam*/
                const targetId = btn.getAttribute("data-target");
                const input = document.getElementById(targetId); /*khi nhan nut thi tim o input tuong ung*/

                const isShown = input.type === "text"; /*checkvar trang thai hien an*/
                input.type = isShown ? "password" : "text"; /*rut gon cua if else*/

                btn.innerHTML = isShown
                    ? '<i class="fa-solid fa-eye"></i>'
                    : '<i class="fa-solid fa-eye-slash"></i>'; /*doi icon theo hien, an*/
            });
        });
        document.getElementById("SignupForm").addEventListener("submit", function (ev) {
            ev.preventDefault(); /*giong cai o duoi*/
        });
        async function hashPassword(password) { /*async la bat dong bo, sai dc await*/
            const encoder = new TextEncoder(); /*tao textcoder*/
            const data = encoder.encode(password); /*chuyen string thanh bytes*/

            const hashBuffer = await crypto.subtle.digest("SHA-256", data); /*api webcrypto de hash SHA-256*/
            const hashArray = Array.from(new Uint8Array(hashBuffer)); /*chuyen arraybuffer ve mang so de doi sang hex*/

            const hashHex = hashArray.map(b => b.toString(16).padStart(2, "0")).join(""); /*chuyen chuoi bytes thanh hex, chuyen bytes thanh so he 16, dam bao luon co 2 ky tu va noi cac doan hex lai voi nhau*/

            return hashHex; /*tra ve chuoi SHA-256*/
        };

        document.getElementById("SignupForm").addEventListener("submit", async function (ev) {
            ev.preventDefault(); /*lay signupform roi lang nghe su kien submit va tranh reload trang, async de bat dong bo*/

            const email = document.getElementById("email").value.trim(); /* lay gia tri nguoi dung, trim de bo khoang blank*/
            const username = document.getElementById("username").value.trim();
            const password1 = document.getElementById("password1").value;
            const password2 = document.getElementById("password2").value;

            let users = JSON.parse(localStorage.getItem("Users")) || []; /*lay danh sach da luu trong localstorage, chuyen string thanh mang*/

            const existed = users.find(u => u.username.toLowerCase() === username.toLowerCase()); /*checkvar trong localstorage xem co usertrung hay ko*/
            if (existed) {
                alert("Username đã được sử dụng!");
                return;
            }

            if (password1 !== password2) { /* checkvar password lan 1 va 2 xem co trung ko*/
                alert("Mật khẩu xác nhận không khớp!");
                return;
            }

            const hashedPassword = await hashPassword(password1); /*goi ham ma hoa mk, co await vi chay ko dong bo*/

            const newUser = {
                email: email,
                username: username,
                password: hashedPassword
            }; /*tao object user moi*/

            users.push(newUser);
            localStorage.setItem("Users", JSON.stringify(users)); /*them user roi luu lai vao localstorage*/

            alert("Đăng ký thành công!");
            window.location.href = "dangnhap1.html";
        }); /*thanh cong va chuyen qua trang dang nhap*/


    </script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-FKyoEForCGlyvwx9Hj09JcYn3nv7wiPVlz7YYwJrWVcXK/BmnVDxM+D2scQbITxI"
        crossorigin="anonymous"></script>
</body>

</html>